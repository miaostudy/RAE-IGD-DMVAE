# Cifar
## 结果
ipc 10：
| 模型       | resnet10 | resnet18 |
|----------|-----------|----------|
| resnet10 |           | 81.3%    |
| resnet18 |           | 82.5%    |

baseline:

## MiniMax
因为是类别引导的Dit, 不训练的话采样出来的全是imagenet的图片
```shell
CUDA_VISIBLE_DEVICES=0,1 torchrun --nnode=1 --nproc_per_node 2 --master_port=25678 MinimaxDiffusion/train_dit.py --model DiT-XL/2      --data-path /data/wlf/datasets --ckpt pretrained_models/DiT-XL-2-256x256.pt      --global-batch-size 8 --tag minimax --ckpt-every 12000 --log-every 1500 --epochs 8      --condense --finetune-ipc -1 --results-dir ../logs/run-0 --dataset cifar10
```
## 代理模型训练
### resnet10
```shell
python IGD/train_ckpts.py -d cifar10 -n resnet --nclass 10 --norm_type instance --tag test --slct_type random --mixup vanilla --repeat 1 --ckpt-dir ./ckpts/cifar10/resnet10/ --epochs 50 --depth 10 --ipc -1 --data_dir /data/wlf/datasets/
```
[](https://youke2.picui.cn/s1/2025/12/29/69525daa32bd4.png)
### resnet18
```shell
python IGD/train_ckpts.py -d cifar10 -n resnet --nclass 10 --norm_type instance --tag test --slct_type random --mixup vanilla --repeat 1 --ckpt-dir ./ckpts/cifar10/resnet18/ --epochs 250 --depth 18 --ipc -1 --data_dir /data/wlf/datasets/
```
acc: 81.3

### convnet6
```shell
python IGD/train_ckpts.py -d cifar10 -n convnet6 --nclass 10 --norm_type instance --tag test --slct_type random --mixup vanilla --repeat 1 --ckpt-dir ./ckpts/cifar10/convnet6/ --epochs 250 --depth 6 --ipc -1 --data_dir /data/wlf/datasets/
```

## 采样
### resnet10
这里采样图像因为生成模型的原因只能生成256的，原数据集是128的。
```shell
python IGD/sample_mp.py --model DiT-XL/2 --image-size 256 --ckpt pretrained_models/cifar10.pt --save-dir "./results/dit-distillation/cifar10-10-minimax-igd-resnet10-k15-gamma10-r1-gi100-low30-high45" --data-path /data/wlf/datasets/ --gm-scale 15 --grad-ipc 10 --net-type resnet --depth 10 --low 30 --high 45  --ckpt_path ckpts --repeat 1 --num-samples 10 --dev-scale 10 --nclass 10 --phase 0 --target_nclass 10 --spec cifar10
```
### resnet18
```shell
python IGD/sample_mp.py --model DiT-XL/2 --image-size 256 --ckpt pretrained_models/cifar10.pt --save-dir "./results/dit-distillation/cifar10-10-minimax-igd-resnet18-k15-gamma10-r1-gi100-low30-high45" --data-path /data/wlf/datasets/ --gm-scale 15 --grad-ipc 10 --net-type resnet --depth 18 --low 30 --high 45  --ckpt_path ckpts --repeat 1 --num-samples 10 --dev-scale 10 --nclass 10 --phase 0 --target_nclass 10 --spec cifar10
```

## 验证
## resnet18
```shell
python IGD/train.py -d cifar10 --imagenet_dir ./results/dit-distillation/cifar10-10-minimax-igd-resnet18-k15-gamma10-r1-gi100-low30-high45 /data/wlf/datasets -n resnet --depth 18 --nclass 10 --norm_type instance --ipc 10 --tag test --slct_type random --spec cifar10 --batch_size 32 --verbose --data_dir=/data/wlf/datasets/

```

# ImageNette
## 结果
### ipc10-Dit
| train\proxy | resnet10  | resnet18  | convnet6 |
|-------------|-----------|-----------|----------|
| resnet10    | 60.3+-0.3 |           |          |
| resnet18    |           | 59.9+-0.4 |          |
| convnet6    |           |           |          |

## MiniMax
训练
```shell
CUDA_VISIBLE_DEVICES=0,1 torchrun --nnode=1 --nproc_per_node 2 --master_port=25678 MinimaxDiffusion/train_dit.py --model DiT-XL/2      --data-path /data/wlf/datasets/imagenet/train/ --ckpt pretrained_models/DiT-XL-2-256x256.pt      --global-batch-size 8 --tag minimax --ckpt-every 12000 --log-every 1500 --epochs 1      --condense --finetune-ipc -1 --results-dir ../logs/run-imagenet-0 --dataset imagenet --spec 1k --nclass 1000
```
采样
```shell
python MinimaxDiffusion/sample.py --model DiT-XL/2 --image-size 256 --ckpt ../logs/run-imagenet-0/013-DiT-XL-2-minimax/checkpoints/0012000.pt \
    --save-dir ../results/dit-distillation/imagenet-10-1000-minimax --spec nette
```
采样模型验证
```shell

```

## ckpt
### resnet-10
```shell
python IGD/train_ckpts.py -d imagenet -n resnet --nclass 10 --norm_type instance --tag test --slct_type random --mixup vanilla --repeat 1 --ckpt-dir ./ckpts/cifar10/resnet10/ --epochs 50 --depth 10 --ipc -1 --imagenet_dir /data/wlf/datasets/imagenette --spec nette
```
acc: 83.2

### resnet-18
```shell
python IGD/train_ckpts.py -d imagenet -n resnet --nclass 10 --norm_type instance --tag test --slct_type random --mixup vanilla --repeat 1 --ckpt-dir ./ckpts/nette/resnet18/ --epochs 100 --depth 18 --ipc -1 --imagenet_dir /data/wlf/datasets/imagenette --spec nette
```
acc: 83.2

论文里的指标: **95.3** , 训练集倒是是这个值

## 采样
### resnet-10-ipc10-minimax
k=15 gamma=10
```shell
python IGD/sample_mp.py --model DiT-XL/2 --image-size 256 --ckpt pretrained_models/minimax.pt \
    --save-dir "./results/dit-distillation/nette-10-minimax-igd-ckpts-resnet10-k15-gamma10-r1-gi200-low30-high45" --data-path /data/wlf/datasets/imagenette/train \
    --spec nette --gm-scale 15 --grad-ipc 200 --net-type resnet --depth 10 \
    --low 30 --high 45 --ckpt_path ckpts --repeat 1 --num-samples 10 --dev-scale 10 \
    --nclass 10 --phase 0 --target_nclass 10
```

### resnet-10-ipc10-minimax
k=15 gamma=10
```shell
python IGD/sample_mp.py --model DiT-XL/2 --image-size 256 --ckpt pretrained_models/0012000.pt \
    --save-dir "./results/dit-distillation/nette-10-minimax-igd-ckpts-resnet10-k15-gamma10-r1-gi200-low30-high45" --data-path /data/wlf/datasets/imagenette/train \
    --spec nette --gm-scale 15 --grad-ipc 200 --net-type resnet --depth 10 \
    --low 30 --high 45 --ckpt_path ckpts --repeat 1 --num-samples 10 --dev-scale 10 \
    --nclass 10 --phase 0 --target_nclass 10
```

### resnet-18-ipc10-minimax
k=15 gamma=10
```shell
python IGD/sample_mp.py --model DiT-XL/2 --image-size 256 --ckpt pretrained_models/0012000.pt \
    --save-dir "./results/dit-distillation/nette-10-minimax-igd-ckpts-resnet18-k15-gamma10-r1-gi200-low30-high45" --data-path /data/wlf/datasets/imagenette/train \
    --spec nette --gm-scale 15 --grad-ipc 200 --net-type resnet --depth 18 \
    --low 30 --high 45 --ckpt_path ckpts --repeat 1 --num-samples 10 --dev-scale 10 \
    --nclass 10 --phase 0 --target_nclass 10
```

### resnet-10-ipc10-dit
k=5 gamma=50
```shell
python IGD/sample_mp.py --model DiT-XL/2 --image-size 256 --ckpt pretrained_models/DiT-XL-2-256x256.pt \
    --save-dir "./results/dit-distillation/nette-10-dit-igd-ckpts-resnet10-k5-gamma50-r1-gi200-low30-high45" --data-path /data/wlf/datasets/imagenette/train \
    --spec nette --gm-scale 5 --grad-ipc 200 --net-type resnet --depth 10 \
    --low 30 --high 45 --ckpt_path ckpts --repeat 1 --num-samples 10 --dev-scale 50 \
    --nclass 10 --phase 0 --target_nclass 10
```

### resnet-18-ipc10-dit
k=5 gamma=50
```shell
python IGD/sample_mp.py --model DiT-XL/2 --image-size 256 --ckpt pretrained_models/DiT-XL-2-256x256.pt \
    --save-dir "./results/dit-distillation/nette-10-dit-igd-ckpts-resnet18-k5-gamma50-r1-gi200-low30-high45" --data-path /data/wlf/datasets/imagenette/train \
    --spec nette --gm-scale 5 --grad-ipc 200 --net-type resnet --depth 18 \
    --low 30 --high 45 --ckpt_path ckpts --repeat 1 --num-samples 10 --dev-scale 50 \
    --nclass 10 --phase 0 --target_nclass 10
```

### resnet-18-ipc50-dit
k=5 gamma=120
```shell
python IGD/sample_mp.py --model DiT-XL/2 --image-size 256 --ckpt pretrained_models/DiT-XL-2-256x256.pt \
    --save-dir "./results/dit-distillation/nette-50-dit-igd-ckpts-resnet18-k5-gamma120-r1-gi200-low30-high45" --data-path /data/wlf/datasets/imagenette/train \
    --spec nette --gm-scale 5 --grad-ipc 200 --net-type resnet --depth 18 \
    --low 30 --high 45 --ckpt_path ckpts --repeat 1 --num-samples 50 --dev-scale 120 \
    --nclass 10 --phase 0 --target_nclass 10
```

## 验证
### resnet10-resnet10
```shell

```
### resnet18-ipc10-dit
```shell
python IGD/train.py -d imagenet --imagenet_dir ./results/dit-distillation/nette-10-dit-igd-ckpts-resnet18-k5-gamma50-r1-gi200-low30-high45 /data/wlf/datasets/imagenette/ -n resnet --depth 18 --nclass 10 --norm_type instance --ipc 10 --tag test --slct_type random --spec nette --batch_size 32 --verbose
```

### resnet10-ipc10-dit
```shell
python IGD/train.py -d imagenet --imagenet_dir ./results/dit-distillation/nette-10-dit-igd-ckpts-resnet10-k5-gamma50-r1-gi200-low30-high45 /data/wlf/datasets/imagenette/ -n resnet --depth 10 --nclass 10 --norm_type instance --ipc 10 --tag test --slct_type random --spec nette --batch_size 32 --verbose
```




同一个模型，只有ckpt准确率有差别，看看结果谁好？